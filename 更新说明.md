# 更新说明 v1.1

## 🎉 新增功能

### 1. 严格的网格移动规则
**修改前**：未明确说明
**修改后**：小车只能**上下左右移动，不能走斜线**

**技术实现**：
- A*算法的邻居节点检查仅包含4个方向（上下左右）
- 代码位置：`findPath()` 函数中的 `neighbors` 数组
```javascript
const neighbors = [
    { x: current.x + 1, y: current.y },  // 右
    { x: current.x - 1, y: current.y },  // 左
    { x: current.x, y: current.y + 1 },  // 下
    { x: current.x, y: current.y - 1 }   // 上
];
```

**影响**：
- 路径更加符合实际仓库操作
- 距离计算使用曼哈顿距离（最优）
- AI和玩家使用相同的移动规则

---

### 2. 智能超载自动卸货
**修改前**：玩家超载时报错并停止游戏
**修改后**：系统**自动在路径中插入卸货动作**

**技术实现**：
- 新增 `convertPlayerRouteWithUnload()` 函数
- 在玩家规划的货物顺序中自动检测超载
- 自动插入返回原点卸货的步骤

```javascript
function convertPlayerRouteWithUnload(playerRoute, capacity) {
    const routeSteps = [];
    let currentLoad = 0;

    for (const item of playerRoute) {
        // 检查是否需要卸货
        if (currentLoad + item.weight > capacity) {
            // 自动插入卸货步骤
            routeSteps.push({ type: 'unload', x: 0, y: 0 });
            currentLoad = 0;
        }
        
        // 拣取货物
        routeSteps.push({ type: 'pickup', item: item, x: item.x, y: item.y });
        currentLoad += item.weight;
    }

    // 最后返回原点
    routeSteps.push({ type: 'return', x: 0, y: 0 });
    
    return routeSteps;
}
```

**优点**：
- 玩家只需关注拣货顺序，不需要手动规划卸货
- 自动优化路径，减少手动操作
- AI和玩家使用相同的超载处理逻辑，公平对比
- 更符合实际WMS系统的自动化特性

**示例场景**：
```
玩家规划顺序：货物A(80kg) → 货物B(70kg) → 货物C(90kg)
小车容量：200kg

系统自动处理：
1. 拣取货物A (当前载重: 80kg) ✓
2. 拣取货物B (当前载重: 150kg) ✓
3. 检测：150 + 90 = 240 > 200 (超载！)
4. 自动插入：返回原点卸货 (载重归零)
5. 拣取货物C (当前载重: 90kg) ✓
6. 返回原点 (完成)
```

---

## 📝 文档更新

### 更新文件列表
1. ✅ `index.html` - 游戏主文件（核心逻辑修改）
2. ✅ `README.md` - 添加"重要特性"章节
3. ✅ `快速开始.txt` - 更新操作说明
4. ✅ `更新说明.md` - 本文件（新增）

### 新增说明章节
- **基本规则**：明确说明移动规则和自动卸货
- **重要特性**：详细解释两个关键功能
- **AI算法详解**：补充说明移动限制

---

## 🧪 测试建议

### 测试场景1：验证网格移动
1. 生成新任务
2. 观察AI路径（显示AI路径）
3. 确认路径只沿着网格边缘（无斜线）

### 测试场景2：验证自动卸货
1. 设置小车载重为 100kg
2. 规划3个货物：60kg + 50kg + 70kg
3. 点击开始对比
4. 观察玩家车是否在第2个货物后自动返回卸货

### 测试场景3：对比公平性
1. 规划玩家路线（随意顺序）
2. 开始对比
3. 查看结果：AI和玩家的卸货次数应该都被正确统计

---

## 🎮 使用提示

### 对玩家的影响
- ✅ **更简单**：不需要考虑何时卸货，只需规划拣货顺序
- ✅ **更智能**：系统自动优化路径
- ✅ **更公平**：AI和玩家规则一致
- ✅ **更真实**：符合实际WMS系统的工作方式

### 策略建议
- 优先拣取距离近的货物（减少总路程）
- 合理安排轻重货物顺序（减少卸货次数）
- 考虑货物分布区域（成片拣货）

---

## 📊 性能影响

- **计算复杂度**：O(n)（n为货物数量）
- **内存占用**：无显著增加
- **动画流畅度**：无影响
- **用户体验**：显著提升 ⬆️

---

## 🔄 版本历史

### v1.1 (当前版本)
- ✅ 添加严格的网格移动规则
- ✅ 实现智能超载自动卸货
- ✅ 更新所有文档说明

### v1.0 (初始版本)
- 基础游戏功能
- AI路径规划
- 玩家手动规划
- 结果对比展示

---

**更新日期**：2025-10-21  
**兼容性**：向后兼容，无需修改现有配置

